var c = 0;
var s = 100;
const u = new URLSearchParams(window.location.search);
const si = u.get('session')?.replaceAll(':', '');

const closeWindow = function () {
    const wd = document.querySelector('#sp-wi-9052 .item-image');
    // if speakol ad widget is present, go to the displayed ad page
    // else go to the KMT free wifi youtube video
    wd !== null ? wd.click() : (window.location.href = 'https://www.youtube.com/watch?v=J7SOfbFzY-E');
    c += 1;
    if (c > 2 && s <= 0) {
        window.location.href = 'https://www.youtube.com/watch?v=J7SOfbFzY-E';
    }
};

const SetRole = function () {
    const d = {
        confirm_reauthorize: true,
        reauthorize_profile: 'Final_Role [authenticated]'
    };
    const url = 'https://erfreewifi.com/api/session/' + si + '/reauthorize';
    $.ajax({
        type: 'Post',
        url: url,
        data: JSON.stringify(d),
        headers: {
            Authorization: 'Bearer eb8e110bd1a6f6107f7aa2f9bab33649755192a7',
            'Content-Type': 'application/json'
        },
        contentType: 'application/json; charset=utf-8',
        Accept: '*/*',
        success: function (res) {
            console.log('res:', res);
        },
        error: function (error) {
            console.log('error: ', error);
        }
    });
};

const t = setInterval(function () {
    document.querySelector('#counterTwo').textContent = --s;
    s === 3 && SetRole();
    s < 1 && (clearInterval(t), (document.querySelector('#counterTwo').textContent = ' إنهاء '), closeWindow());
}, 1000);
